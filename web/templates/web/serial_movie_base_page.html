{% extends 'web/base.html' %}
{% load static %}
{% load check_favorite %}
{% load forx %}
{% load minute_to_hours_convertor %}
{% block title_style %}
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
    <link rel="stylesheet" href="{% static 'css/movie_serial_page.css' %}">
    <title>
        {% if content.title %}
            {{ content.title }}
        {% else %}
            {{ content.serial_name }}
        {% endif %}
    </title>
{% endblock title_style %}

{% block content %}
    {% csrf_token %}
    <section class="main_movie_serial_section">
        <div class="container">
            <div class="row centered_block">
                <div class="col-lg-auto col-md-12">
                    <div class="position-relative container_image_single_page">
                        <img class="mov_ser_img" src="{{ content.poster.url }}" alt>
                        <div class="position_tags d-flex position-absolute">
                            <div data-value="{{ content.slug }}" data-value-type="film"
                                 class="svg_heart_container {{ content.slug }}_cls_favorite">
                                {% favorite_movie content request 'Favorite' as favorite_bool %}
                                {% if favorite_bool %}
                                    <svg class="card_svg_style_single_page favourite_film"
                                         version="1.1"
                                         id="Capa_1"

                                         xmlns="http://www.w3.org/2000/svg"
                                         xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                                         width="45.743px" height="45.743px" viewBox="0 0 45.743 45.743"
                                         xml:space="preserve">
                                            <g>
                                                <path d="M34.199,3.83c-3.944,0-7.428,1.98-9.51,4.997c0,0-0.703,1.052-1.818,1.052c-1.114,0-1.817-1.052-1.817-1.052
                                                    c-2.083-3.017-5.565-4.997-9.51-4.997C5.168,3.83,0,8.998,0,15.376c0,1.506,0.296,2.939,0.82,4.258
                                                    c3.234,10.042,17.698,21.848,22.051,22.279c4.354-0.431,18.816-12.237,22.052-22.279c0.524-1.318,0.82-2.752,0.82-4.258
                                                    C45.743,8.998,40.575,3.83,34.199,3.83z"/>
                                            </g>
                                        </svg>
                                {% else %}
                                    <svg class="card_svg_style_single_page" version="1.1" id="Capa_1"

                                         xmlns="http://www.w3.org/2000/svg"
                                         xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                                         width="45.743px" height="45.743px" viewBox="0 0 45.743 45.743"
                                         xml:space="preserve">
                                            <g>
                                                <path d="M34.199,3.83c-3.944,0-7.428,1.98-9.51,4.997c0,0-0.703,1.052-1.818,1.052c-1.114,0-1.817-1.052-1.817-1.052
                                                    c-2.083-3.017-5.565-4.997-9.51-4.997C5.168,3.83,0,8.998,0,15.376c0,1.506,0.296,2.939,0.82,4.258
                                                    c3.234,10.042,17.698,21.848,22.051,22.279c4.354-0.431,18.816-12.237,22.052-22.279c0.524-1.318,0.82-2.752,0.82-4.258
                                                    C45.743,8.998,40.575,3.83,34.199,3.83z"/>
                                            </g>
                                        </svg>
                                {% endif %}
                            </div>
                            <div data-value="{{ content.slug }}" data-value-type="film"
                                 class="svg_bookmark_container {{ content.slug }}_cls_bookmark">
                                {% favorite_movie content request 'Later' as book_mark %}
                                {% if book_mark %}
                                    <svg class=" card_svg_style_single_page later_film" version="1.1"
                                         id="Capa_1"
                                         xmlns="http://www.w3.org/2000/svg"
                                         xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                                         width="459px" height="459px" viewBox="0 0 459 459"
                                         style="enable-background:new 0 0 459 459;"
                                         xml:space="preserve">
                                                    <g>
                                                        <g id="bookmark">
                                                            <path d="M357,0H102C73.95,0,51,22.95,51,51v408l178.5-76.5L408,459V51C408,22.95,385.05,0,357,0z"/>
                                                        </g>
                                                    </g>
                                                    </svg>
                                {% else %}
                                    <svg class=" card_svg_style_single_page" version="1.1" id="Capa_1"
                                         xmlns="http://www.w3.org/2000/svg"
                                         xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                                         width="459px" height="459px" viewBox="0 0 459 459"
                                         style="enable-background:new 0 0 459 459;"
                                         xml:space="preserve">
                                                    <g>
                                                        <g id="bookmark">
                                                            <path d="M357,0H102C73.95,0,51,22.95,51,51v408l178.5-76.5L408,459V51C408,22.95,385.05,0,357,0z"/>
                                                        </g>
                                                    </g>
                                                    </svg>
                                {% endif %}
                            </div>
                        </div>
                    </div>


                </div>
                <div class="col-lg-auto col-md-12">
                    <div class="left_block">
                        <div class="name_film_block">
                            {% block name_film_serial %}
                            {% endblock name_film_serial %}
                        </div>
                        <div class="about_film_block">
                            <ul class="px-0 ">
                                <li class="d-flex about_film_block_container_li">
                                    <div class="about_film_attribute">
                                        <h4>Release date</h4>
                                    </div>
                                    <div class="about_film_attribute_content">
                                        <h4>{{ content.release_date }}</h4>
                                    </div>
                                </li>
                                <li class="d-flex about_film_block_container_li">
                                    <div class="about_film_attribute">
                                        <h4>Genre</h4>
                                    </div>
                                    <div class="about_film_attribute_content">
                                        <h4>{{ content.genre.all|join:", " }}</h4>
                                    </div>
                                </li>
                                <li class="d-flex about_film_block_container_li">
                                    <div class="about_film_attribute">
                                        <h4>Country</h4>
                                    </div>
                                    <div class="about_film_attribute_content">
                                        <h4>{{ content.country }}</h4>
                                    </div>
                                </li>
                                <li class="d-flex about_film_block_container_li">
                                    <div class="about_film_attribute"><h4>Director</h4></div>
                                    <div class="about_film_attribute_content">
                                        <h4>{{ content.director }}</h4>
                                    </div>
                                </li>
                                <li class="d-flex about_film_block_container_li">
                                    <div class="about_film_attribute"><h4>Time</h4></div>
                                    {% if content.title %}
                                        <div class="about_film_attribute_content">
                                            <h4>
                                                {{ content.time_minute }}
                                                / {{ content.time_minute | hours_convertor }}
                                            </h4>
                                        </div>
                                    {% else %}
                                        <div class="about_film_attribute_content">
                                            <h4>{{ content.time_minute }}</h4>
                                        </div>
                                    {% endif %}
                                </li>
                                {% if not content.title %}
                                    <li class="d-flex about_film_block_container_li">
                                        <div class="about_film_attribute">
                                            <h4>Seasons</h4>
                                        </div>
                                        <div class="about_film_attribute_content">
                                            <h4>{{ content.seasons.count }}</h4>
                                        </div>
                                    </li>
                                {% endif %}
                                <li class="d-flex about_film_block_container_li">
                                    <div class="about_film_attribute">
                                        <h4>Age</h4>
                                    </div>
                                    <div class="about_film_attribute_content">
                                        <h4 class="film_serial_rating_sys mpa_age_rating">{{ content.age_rating_sys }}</h4>
                                    </div>
                                </li>
                                <li class="d-flex about_film_block_container_li">
                                    <div class="about_film_attribute">
                                        <h4>Rating MPAA</h4>
                                    </div>
                                    <div class="about_film_attribute_content">
                                        <h4 class="film_serial_rating_sys mpa_age_rating">{{ content.mpa_rating_sys }}</h4>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="сol-12 d-flex rating_bar d-flex flex-column">
                    <div id="cinema_bar_rating_system" class="d-flex">
                        <div class="many_star_container d-flex">

                            {% for i in 10|for_range %}
                                <div class="one_star_div">
                                    <a name="{{ i| add:1 }}" class="one_star_container d-flex">
                                        <div class="svg_star_container">
                                            <svg class="svg_star_mark" version="1.1" xmlns="http://www.w3.org/2000/svg"
                                                 xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                                                 width="940.688px" height="940.688px" viewBox="0 0 940.688 940.688"
                                                 style="enable-background:new 0 0 940.688 940.688;"
                                                 xml:space="preserve">
                                        <defs>
                                            <lineargradient id="grad_{{ i }}">
                                                <stop offset="50%" stop-color="yellow"></stop>
                                                <stop offset="50%" stop-color="grey"></stop>
                                            </lineargradient>
                                       </defs>
                                                <path d="M885.344,319.071l-258-3.8l-102.7-264.399c-19.8-48.801-88.899-48.801-108.6,0l-102.7,264.399l-258,3.8
                                                    c-53.4,3.101-75.1,70.2-33.7,103.9l209.2,181.4l-71.3,247.7c-14,50.899,41.1,92.899,86.5,65.899l224.3-122.7l224.3,122.601
                                                    c45.4,27,100.5-15,86.5-65.9l-71.3-247.7l209.2-181.399C960.443,389.172,938.744,322.071,885.344,319.071z"/>
                                    </svg>
                                        </div>
                                        <p class="my-0 p_star_text">{{ i |add:1 }}</p>
                                    </a>
                                </div>

                            {% endfor %}
                        </div>
                        {% if not rating.rating %}
                            <h2 id="true_rating_cinema" name="{{ content.IMDb_RATING }}"
                                class="rating_cinema_color mov_rating_text my-0">{{ content.IMDb_RATING }}</h2>
                        {% else %}
                            <h2 id="true_rating_cinema" name="{{ rating.rating }}"
                                class="rating_cinema_color mov_rating_text my-0">{{ content.IMDb_RATING }}</h2>
                        {% endif %}
                    </div>
                    {% if rating.rating %}
                        <div class="d-flex flex-column" id="user_rating">
                            <div class="d-flex justify-content-start align-content-center align-items-center">
                                <h4 class="m-0 mov_rating_text font_class_style_rating">Your evaluation </h4>
                                <p class="m-0 rating_cinema_color font_class_style_rating">{{ rating.rating }}</p>
                                {% block data_type_serial_film %}
                                {% endblock data_type_serial_film %}
                            </div>
                            <p class="font_class_style_rating time_styles mov_rating_text">{{ rating.created|date:'Y-m-d H:i' }}</p>
                        </div>
                    {% endif %}
                </div>
                <div class="col-12 synopsys_title">
                    <h2 class="mov_ser_text">Synopsis</h2>
                </div>
                <div class="col-12">
                    <div class="synopsys_block">
                        <p class="mov_ser_text p_star_text">{{ content.summary }}</p>
                    </div>
                </div>
            </div>
            {% if movie_reviews %}
                <div class="row">
                    <h2 class="mov_rating_text" style="text-align: start">Users Review</h2>
                </div>
                <div class="row">
                    <div class="col-md-10 order-md-1 col-sm-12 order-last">
                        <div id="users_review" style="margin-top: 40px">

                            {% for review in movie_reviews %}
                                <div data-type="{{ review.review_type }}"
                                     class="border_style_form user_review_container"
                                     style="margin-top: 20px">
                                    <div class="user_info">
                                        <a href="{% url 'profile_page' review.user.username %}">{{ review.user.username }}</a>
                                        <h4 class="mov_rating_text">{{ review.created |date:'Y-m-d H:i'}}</h4>
                                    </div>
                                    <div class="user_review">
                                        <div class="title_form_review_container">
                                            <h4 class="mov_rating_text">{{ review.title }}</h4>
                                            <h4 class="mov_rating_text">{{ review.review_type }}</h4>
                                        </div>
                                        <div class="text_form_review_container">
                                            <p class="mov_rating_text">{{ review.text }}</p>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}

                        </div>
                    </div>

                    <div class="col-md-2 order-md-1 col-sm-12 order-first" style="margin-top: 40px;">
                        <div style="position: sticky; top: 100px">

                            <h4 data-type="Total" class="mov_rating_text rating_bar_select_cls">
                                Total: {{ calculated.total }}</h4>
                            {% if calculated.Positives %}
                                <h4 data-type="Positive" class="mov_rating_text rating_bar_select_cls">
                                    Positive: {{ calculated.Positives.Positive }}
                                </h4>
                            {% endif %}
                            {% if calculated.Neutrals %}
                                <h4 data-type="Neutral" class="mov_rating_text rating_bar_select_cls">
                                    Neutral: {{ calculated.Neutrals.Neutral }}
                                </h4>
                            {% endif %}
                            {% if calculated.Negatives %}
                                <h4 data-type="Negative" class="mov_rating_text rating_bar_select_cls">
                                    Negative: {{ calculated.Negatives.Negative }}
                                </h4>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% endif %}
            {% if request.user.is_authenticated and not have_review %}
                <div id="write_review_user" class="row block_review_write">
                    <div class="col-10">
                        <h2 class="mov_rating_text" style="text-align: start">Write a review</h2>
                        <form method="post" id="form_view_submit" name="{{ content.slug }}">
                            <div class="border_style_form">
                                <div class="user_info">
                                    <a href="{% url 'profile_page' request.user.username %}">{{ request.user.username }}</a>
                                </div>
                                <div class="user_review">
                                    <div class="custom-select">
                                        <select id="mounth" aria-label>
                                            <option value="hide">Review type</option>
                                            <option value="january">Positive</option>
                                            <option value="february">Neutral</option>
                                            <option value="march">Negative</option>
                                        </select>
                                    </div>
                                    <div class="title_form_review_container">
                                        <input id="input_title" class="w-100" maxlength="10" required>
                                    </div>
                                    <div class="text_form_review_container">
                                        <textarea id="textarea_form_review" class="text_area_review w-100"
                                                  required></textarea>
                                    </div>
                                    <div class="button_form_review_container">
                                        <button id="button_review_send" type="button"
                                                class="disable_btn btn_from_review">Send
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            {% endif %}
        </div>

    </section>
{% endblock content %}


{% block script %}
    <script src="{% static 'js/star_fill.js' %}"></script>
    <script src="{% static 'js/change_p_text_size.js' %}"></script>
    <script src="{% static 'js/rating_color_changer.js' %}"></script>
    <script src="{% static 'js/ajax_rating_star_put.js' %}"></script>
    <script src="{% static 'js/ajax_delete_rating_user.js' %}"></script>
    <script src="{% static 'js/select_menu_review.js' %}"></script>
    <script src="{% static 'js/ajax_review_user.js' %}"></script>
    <script src="{% static 'js/ajax_favoriteFilm.js' %}"></script>
    <script src="{% static 'js/ajax_laterFilm.js' %}"></script>
    <script src="{% static 'js/start_btn_on_single_page_movie_serial.js' %}"></script>
    <script src="{% static 'js/filtering_data_review.js' %}"></script>
{% endblock script %}